# HTTP 文件和文本服务器

一个简单的HTTP服务器，支持文件上传、下载和文本保存功能。

## 功能特性

- **文件上传**: 支持大文件上传，使用流式传输避免内存溢出
- **文件下载**: 支持大文件下载，使用分块传输
- **文本保存**: 保存文本内容到文件
- **文件管理**: 查看、下载、删除文件
- **用户偏好**: 记住上次的设置和选择
- **网络接口选择**: 自动检测并选择网络接口

## 大文件传输改进

### 解决的问题
- **MemoryError**: 原版本在传输大文件时会将整个文件读入内存，导致内存溢出
- **连接超时**: 增加了超时设置和错误处理
- **文件大小限制**: 可配置的最大文件大小限制

### 技术改进
1. **流式传输**: 使用8KB分块读写，避免内存溢出
2. **错误处理**: 完善的异常捕获和错误恢复
3. **配置选项**: 可配置的最大文件大小和传输块大小
4. **进度显示**: 更好的文件大小格式化显示

## 使用方法

### 基本用法
```bash
python http_server.py
```

### 高级选项
```bash
# 指定端口
python http_server.py -p 8080

# 设置最大文件大小 (MB)
python http_server.py -m 2048

# 组合使用
python http_server.py -p 8080 -m 2048
```

### 交互式设置
启动服务器后，程序会提示你：
1. **选择网络接口**: 如果有多个网络接口可用
2. **设置最大文件大小**: 可以选择修改默认的最大文件大小

程序会记住你的设置，下次启动时自动使用上次的配置。

### 命令行参数
- `-p, --port`: 服务器端口 (默认: 8000)
- `-m, --max-size`: 最大文件大小(MB) (默认: 1024 MB)

## 配置说明

### 文件传输配置
- `CHUNK_SIZE`: 传输块大小 (默认: 8KB)
- `MAX_FILE_SIZE`: 最大文件大小 (默认: 1GB)

### 服务器配置
- 超时时间: 5分钟
- 支持地址重用
- 自动检测网络接口

## 错误处理

- **413 Payload Too Large**: 文件超过最大大小限制
- **500 Internal Server Error**: 文件传输失败
- **404 Not Found**: 文件不存在
- **连接断开**: 自动处理客户端断开连接

## 使用示例

1. 启动服务器:
   ```bash
   python http_server.py -p 8080 -m 2048
   ```

2. 在浏览器中访问显示的地址

3. 上传大文件 (最大2GB)

4. 下载文件，支持断点续传

## 注意事项

- 确保有足够的磁盘空间存储上传的文件
- 大文件传输可能需要较长时间，请耐心等待
- 建议在稳定的网络环境下使用
- 服务器会自动保存用户偏好设置
